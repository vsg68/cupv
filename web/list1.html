<!DOCTYPE html>
<html>
<head>
    <META http-equiv="content-type" content="text/html; charset=utf-8">
    <link rel="stylesheet" href="/codebase/webix.css" type="text/css" media="screen" charset="utf-8">
    <link rel="stylesheet" href="/css/main.css" type="text/css" media="screen" charset="utf-8">
    <script src="/codebase/webix_debug.js" type="text/javascript" charset="utf-8"></script>
    <title>Something</title>
</head>
<style>
    /*.folder_grp*/
   /*.groups .webix_tree_folder_open,*/
   /*.groups .webix_tree_folder*/
    /*{*/
        /*background-image: url(images/groups.png);*/
        /*background-position: 0px 4px;*/
    /*}*/
   /*.groups .webix_tree_file{*/
        /*background-image: url(images/usr1.png);*/
        /*background-position: 0px 4px;*/
    /*}*/
    /*.my_style{*/
        /*background-color:#FFAAAA;*/
    /*}*/
</style>

<body>

<script type="text/javascript" charset="utf-8">
        //plain json data, based on objects
var addUsr = {
    view: "button", type: "iconButton", icon: "user", label: "New", width: 70,
};
var buttonMinus = {
    view: "button", type: "iconButton", icon: "minus", label: "Del", width: 70,
}

function testFunc(setup) {
    var opt1 = setup.opt1 || 14;
    var opt2 = setup.opt2 || 15;
    alert(opt1 +"," +opt2);
}

        testFunc(13,15);

var treea = {
            id: "list_domains",
            view:"list", select:true,
            url: "/domains/showTable/",
            type: { height: 40 },
            on: {
                onAfterLoad: function(){
                    this.filter( function(data){ return data.domain_type == "0"})
                },
                "onKeyPress": function (key) {
//                        formId = ( this.getSelectedItem()['$parent'] ) ? "form_groups_RS" : "form_groups_Txt";
                    keyPressAction(this, key, formId);
                }
            },
            template: function(obj){
                var tmpl = "<div class='fleft domain_name isactive_" + obj.active + "'  title='" + (obj.domain_notes ? obj.domain_notes : "") + "'>" + obj.domain_name + "</div>";

                if (obj.domain_type)                tmpl += "<div class='fleft fa-exchange webix_icon domain_type_" + obj.domain_type + "' title='" + obj.delivery_to+ "'></div>";
                if (obj.all_enable == "1")          tmpl += "<div class='fleft fa-envelope webix_icon' title='рассылка: " + obj.all_email + "'></div>";
                if (obj.relay_domain == "1")        tmpl += "<div class='fleft fa-share webix_icon' title='relay: " + obj.relay_address + "'></div>";
                if (obj.relay_notcheckusers == "1") tmpl += "<div class='fleft fa-check webix_icon' title='check users'></div>";

                return tmpl;
            }
        };
var tabb =  { view:"segmented",
//              css: "tabbar",
              options:[
                {id:0, value:"Основные"},
                {id: 1, value: "Алиасы"},
                {id:2, value: "Транспорт"},
              ],
              click: function(obj){
                        $$("list_domains").filter( function(data){
                            return data.domain_type == $$(obj).getValue();
                        });
            }
        };
var tb = {
    view: "toolbar",
    height: 30,
    cols: [tabb, {view: "label", label: "Groups"}, addUsr,buttonMinus]
};
var mf = {
     view: "multiview",
     newID: "",
     css: "win",
     cells: [ treea ,
                { id: "form_tree", view: "form", elementsConfig: {labelWidth: 110}, elements: [
                    {view: "text", label: "Название", name: "domain_name" },
                    {view: "text", label: "Описание", name: "domain_notes" },
                    {view: "fieldset", label:"Рассылка", body: {
                        rows:[
                                {view: "checkbox", label: "Рассылка.Вкл", name: "all_enable" },
                                {view: "text", label: "Рассылка", name: "all_email" },
                              ]
                    }},
                    {view: "fieldset", label:"Relay", body: {
                        rows: [
                                {view: "checkbox", label: "Вкл.Пересылку", name: "relay_enable" },
                                {view: "text", label: "Пересылка", name: "relay_address" },
                                {view: "checkbox", label: "Проверка польз.", name: "relay_notcheckusers"},
                                ]
                    }},
                    {view: "checkbox", label: "Активно", name: "active"},
                    { margin: 5, cols: [
                        {},
                        { view: "button", value: "Cancel", width: 70, click: "cancel()" },
                        { view: "button", value: "Save", width: 70, type: "form", click: "save_form" },
                        {}
                    ]},
                    {}
                ],
                    rules: {
                        alias_name: webix.rules.isEmail,
                        delivery_to: webix.rules.isEmail
                    }
                }
            ]
        }

// TODO таббар с кнопками добавления 1) групп 2) ползователей 3) удаления
//        форма добавления групп - текст, проверка на существование
//        пользователей - список почтовых ящиков

webix.ready(function () {
    // Вывод основного представления

    webix.ui({rows:[tb, mf] , width: 600});
    $$('form_tree').bind('list_tree');
});


</script>
</body>
</html>